%INCLUDE:header.pvt.html%
<div id="subheader">
	<a class="back" href="../main">Home</a>
</div>

<script type="text/javascript" language="javascript">
    function printPagesHTML( numberOfPages, currentPage, parameters)
    {
        if( numberOfPages > 1)
        {
            document.write("Pages:  ");
            
            var i=0;
            var previous=0;
            previous = currentPage-1;
            if( currentPage == 0) document.write("<<  ");
            else document.write("<b><a href='?"+parameters+"&page="+previous+"'><<  </a></b>");
            
            var start = 1;
            var end = numberOfPages+1;
            
            if( end - start > 10)
            {
                start = currentPage - 3;
                end = currentPage + 6;
            }
            
            if( start < 1)
            {
                end += (-start+1);
                if( end > numberOfPages+1)
                end = numberOfPages+1;
                
                start = 1;
            }
            
            if( end > numberOfPages+1)
            {
                start -= end - numberOfPages;
                if( start < 1)
                start = 1;
                
                end = numberOfPages+1;
            }
            
            if( start == 2)
            start = 1;
            
            if( end == numberOfPages)
            end = numberOfPages+1;
            
            if( start != 1)
            {
                var p = 1;
                
                if( 1 == currentPage+1) document.write("<b><u>"+p+"</u></b>  ");
                else document.write("<a href='?"+parameters+"&page="+0+"'>"+1+"</a>  ");
                
                document.write("  ...  ");
            }
            
            for (i=start;i<end;i++)
            {
                var page = i-1;
                if( i == currentPage+1) document.write("<b><u>"+i+"</u></b>  ");
                else document.write("<a href='?"+parameters+"&page="+page+"'>"+i+"</a>  ");
            }
            
            if( end != numberOfPages+1)
            {
                document.write("  ...  ");
                
                var p = 0;
                
                p = numberOfPages;
                pp = p-1;
                
                if( numberOfPages == currentPage+1) document.write("<b><u>"+p+"</u></b>  ");
                else document.write("<a href='?"+parameters+"&page="+pp+"'>"+p+"</a>  ");
            }
            
            var next=0;
            next = currentPage+1;
            if( next >= numberOfPages) document.write("  >>");
            else document.write("<b><a href='?"+parameters+"&page="+next+"'>  >></a></b>");
        }
    }
</script>

<div id="content">
	%INCLUDE:/errors.pvt.html%
	%INCLUDE:/messages.pvt.html%

	<div>
        %[IF:Studies.count%
        
        %Session.NumberOfStudies% Studies Found<br>
        <script type="text/javascript">
            printPagesHTML( %Session.NumberOfPages%, %Session.Page%, "%Info.getParameters(page=)%");
        </script>
        <br>
        
        <div>
			<div class="smaller right gray">
				Sorted by:
				<a %[IF:Session.StudiesSortKey=="name"%class="CurrentSortKey"%]IF:Session.StudiesSortKey=="name"% href="?%Info.getParameters(sortKey=name)%">name</a>,
				<a %[IF:Session.StudiesSortKey=="date"%class="CurrentSortKey"%]IF:Session.StudiesSortKey=="date"% href="?%Info.getParameters(sortKey=date)%">date</a>
			</div>
			<table class="wide separated fat">
				%[FOREACH:Studies:Study%
					<tr class="li%Study_Index2%">	
						<td class="">
							<a href="study?%Info.getParameters(sortKey=)%&xid=%Study.XID%">
								<span class="bigger compressed">%X:ZWS:Study.name%</span> <span class="gray details">%X:Study.modality%, %X:Study.imageSeries.count% series%[IF:Study.patientID%, %X:Study.patientID%%]IF:Study.patientID%%[IF:Study.accessionNumber%, %X:Study.accessionNumber%%]IF:Study.accessionNumber%</span>
								<div class="gray indent compressed">
									%X:ZWS:Study.studyName%
									%[IF:Study.comment%<div class="italic indent">%X:ZWS:Study.comment%</div>%]IF:Study.comment%
								</div>
							</a>
						</td>
					
						<td class="gray top right fat">
							%[IF:Study.date%
							<div>%Study.date.DateTime.Spanned%</div>
							%]IF:Study.date%
				
							%[IF:Study.stateText%
							<div>%X:Study.stateText%</div>
							%]IF:Study.stateText%
						</td>
						
						%[IF:Info.isMacOS%
						%[IF:Info.proposeWADORetrieve%
						<td class="narrow middle">
							<a href="osirix://?methodName=DownloadURL&Display=YES&URL='%Info.WADOBaseURL%?requestType=WADO&studyUID=%U:Study.studyInstanceUID%'"><img src="images/osirix.png"/></a>
						</td>
						%]IF:Info.proposeWADORetrieve%
						%]IF:Info.isMacOS%
						
						%[IF:Info.proposeZipDownload%
						<td class="narrow middle">
							<a href="%U:Study.name% - %U:Study.studyName%.%[IF:Info.isMacOS%osirixzip%ELSE:Info.isMacOS%zip%]IF:Info.isMacOS%?xid=%Study.XID%"><img src="images/download.png"/></a>
						</td>
						%]IF:Info.proposeZipDownload%
						
						%[IF:Info.proposeWeasis%
						<td class="narrow middle">
							<a href="/weasis.jnlp?xid=%Study.XID%"><img src="images/weasis.png"/></a>
						</td>
						%]IF:Info.proposeWeasis%
					</tr>
				%]FOREACH:Studies:Study%
			</table>
		</div>
		<script type="text/javascript">
            printPagesHTML( %Session.NumberOfPages%, %Session.Page%, "%Info.getParameters(page=)%");
        </script>
		%ELSE:Studies.count%
		This list is empty.
		%]IF:Studies.count%
	</div>

</div>

%INCLUDE:footer.pvt.html%