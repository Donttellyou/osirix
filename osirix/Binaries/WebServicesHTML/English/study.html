%INCLUDE:header.pvt.html%
<div id="subheader">
	<a class="back" href="studyList?%Info.getParameters(xid=)%">%BackLinkLabel%</a>
</div>

<script type="text/javascript" language="javascript">

function checkAll(form) {
	for (var i = 0; i < form.selected.length; i++)
		form.selected[i].checked = true;
	checkboxChanged(form);
}

function uncheckAll(form) {
	for (var i = 0; i < form.selected.length; i++)
		form.selected[i].checked = false;
	checkboxChanged(form);
}

function checkboxChanged(form) {
	var allChecked = true;
	var allUnchecked = true;
	for (var i = 0; i < form.selected.length; i++) {
		if (allChecked && !form.selected[i].checked) allChecked = false;
		if (allUnchecked && form.selected[i].checked) allUnchecked = false;
	}
	
	form.CheckAll.disabled = allChecked;
	form.UncheckAll.disabled = allUnchecked;
}

function onSubmitForm(form) {
	if (document.submitting == 'Weasis')
		form.action ="weasis.jnlp";
	else form.action = document.location;
	if (form.message.value == form.message.defaultValue)
		form.message.value = '';
	return true;
}

</script>

<form id="form" method="post" onsubmit="return onSubmitForm(this);">
<div id="content">
	%INCLUDE:/errors.pvt.html%
	%INCLUDE:/messages.pvt.html%

	<div>
		<div class="title">Study Information</div>
		<div>
			<table class="form">
				<tr>
					<td>Patient's name:</td>
					<td>%X:Study.name%</td>
				</tr>
				<tr>
					<td>Date&nbsp;of&nbsp;birth:</td>
					<td>%X:Study.dateOfBirth.Date%</td>
				</tr>
				<tr>
					<td>Patient&nbsp;ID:</td>
					<td>%X:Study.patientID%</td>
				</tr>
				<tr>
					<td>Accession&nbsp;number:</td>
					<td>%X:Study.accessionNumber%</td>
				</tr>
				<tr>
					<td>Study&nbsp;date:</td>
					<td>%Study.date.DateTime.Spanned%</td>
				</tr>
				<tr>
					<td>Modality:</td>
					<td>%X:Study.modality%</td>
				</tr>
				<tr>
					<td>Description:</td>
					<td>%X:Study.studyName%</td>
				</tr>
				%[IF:Study.comment%
				<tr>
					<td>Comment:</td>
					<td>%X:Study.comment%</td>
				</tr>
				%]IF:Study.comment%
				%[IF:Study.stateText%
				<tr>
					<td>Study&nbsp;state:</td>
					<td>%X:Study.stateText%</td>
				</tr>
				%]IF:Study.stateText%
				%[IF:Study.reportIsLink%
				<tr>
					<td>Report:</td>
					<td><a href="%X:Study.reportURL%" target="blank" class="report">Link to Report</a></td>
				</tr>
				%ELSE:Study.reportIsLink%
				%[IF:Study.reportURL&&!Info.isIOS%
				<tr>
					<td>Report:</td>
					<td><a href="report.%U:Study.reportExtension%?xid=%Study.XID%" class="report">Download Report</a></td>
				</tr>
				%]IF:Study.reportURL&&!Info.isIOS%
				%]IF:Study.reportIsLink%
			</table>
		</div>

		<div class="separated title">Series</div>
		<div>
			<table class="wide fat">
				%[FOREACH:Series:Series%
					<tr class="li%X:Series_Index2%">				
						%[IF:Info.proposeDicomSend||Info.proposeWeasis%
						<td class="narrow fat">
							<input type="checkbox" class="checkbox" name="selected" value="%Series.XID%" onchange="checkboxChanged(this.form)" %[IF:Series.isSelected%checked="checked"%]IF:Series.isSelected% />
						</td>
						%]IF:Info.proposeDicomSend||Info.proposeWeasis%
						<td class="narrow middle center">
							<a class="series" href="series%Series.seriesExtension%?xid=%Series.XID%&%Info.getParameters(xid=)%">
								<img src="/thumbnail?xid=%Series.XID%" />
							</a>
						</td>
						<td class="fat">
							<a class="series" href="series%Series.seriesExtension%?xid=%Series.XID%&%Info.getParameters(xid=)%">
								<span class="bigger">%X:Series.name%</span>
								<span class="gray">
									%[IF:Series.stateText%
										%X:Series.stateText%,
									%]IF:Series.stateText%
									%[IF:Series.noFiles<2%
										1 image
									%ELSE:Series.noFiles<2%
										%Series.noFiles% images
									%]IF:Series.noFiles<2%
								</span>
								%[IF:Series.comment%
									<div class="gray indent">%X:Series.comment%</div>
								%]IF:Series.comment%	
								</span>
							</a>
						</td>
		
						<td class="narrow middle">
							%[IF:Info.proposeZipDownload%
							<a href="%U:Study.name% - %U:Series.name%.%[IF:Info.isMacOS%osirixzip%ELSE:Info.isMacOS%zip%]IF:Info.isMacOS%?xid=%Series.XID%"><img src="images/download.png"/></a>
							%]IF:Info.proposeZipDownload%
						</td>
	
						%[IF:Info.proposeWeasis%
						<td class="narrow middle">
								<a href="/weasis.jnlp?xid=%Series.XID%"><img src="images/weasis.png"/></a>
						</td>
						%]IF:Info.proposeWeasis%
					</tr>
				%]FOREACH:Series:Series%
	
				%[IF:Info.proposeDicomSend||Info.proposeWeasis%
				<tr>
					<td colspan="3">
					%[IF:Series.count>1%
						<button type="button" name="CheckAll" onclick="checkAll(this.form)">Check All</button>
						<button type="button" name="UncheckAll" onclick="uncheckAll(this.form)">Uncheck All</button>
						<script type="text/javascript" language="javascript">
							checkboxChanged(document.getElementById('form'));
						</script>
					%]IF:Series.count>1%
					</td>
					%[IF:Info.proposeZipDownload%
					<td>
					</td>
					%]IF:Info.proposeZipDownload%
					%[IF:Info.proposeWeasis%
					<td class="narrow middle">
						<input type="image" src="images/weasis.png" alt="Open selected series in Weasis" onclick="document.submitting='Weasis'" />
					</td>
					%]IF:Info.proposeWeasis%
				</tr>
				%]IF:Info.proposeDicomSend||Info.proposeWeasis%
			</table>
		</div>
	
		%[IF:Info.proposeShare&&ShareDestinations.count%
		<div class="title separated">Share</div>
		<div>
			<table class="basic wide form">
				<tr>
					<td>User:</td>
					<td>
						<select name="shareStudyDestination">
							%[FOREACH:ShareDestinations:Dest%
							<option value="%Dest.XID%">%X:Dest.name%</option>
							%]FOREACH:ShareDestinations:Dest%
						</select>
					</td>
				</tr>
				<tr>
					<td>Message:</td>
					<td>
						<textarea name="message" id="shareStudyMessage" style="color:#666666"
							onfocus="if (this.value == this.defaultValue) { this.value=''; this.style.color='#000000'; }"
							onblur="if (this.value == '') { this.value = this.defaultValue; this.style.color='#666666'; }">Fill this field to specify a message that will be included in the notification e-mail sent to this user.</textarea>
					</td>
				</tr>
				<tr>
					<td></td>
					<td>
						<button type="submit" name="shareStudy" value="shareStudy" onclick="document.submitting='Share'">Share</button>
					</td>
				</tr>
			</table>
		</div>
		%]IF:Info.proposeShare&&ShareDestinations.count%
	
		%[IF:Info.proposeDicomSend%
		<div class="title separated">DICOM Transfer</div>
		<div>
			<table class="form">
				<tr>
					<td>Destination:</td>
					<td>
						<select name="dicomDestination" id="dicomDestination">
							%[FOREACH:DicomDestinations:Dest%
							<option value="%U:Dest.address%:%U:Dest.port%:%U:Dest.aeTitle%:%U:Dest.syntax%">%X:Dest.description%</option>
							%]FOREACH:DicomDestinations:Dest%
						</select>
						<button type="submit" name="dicomSend" value="dicomSend" onclick="document.submitting='Send'">Send</button>
					</td>
				</tr>
			</table>
		</div>
		%]IF:Info.proposeDicomSend%
	</div>
	
</div>
</form>

%INCLUDE:footer.pvt.html%
